# DS2: fast, accurate, automatic scaling decisions for distributed streaming dataflows.

DS2 is a low-latency controller for dynamic scaling of streaming analytics applications. It can accurately estimate parallelism for all dataflow operators within a _single_ scaling decision, and operates _reactively_ online. DS2 bases scaling decisions on real-time performance traces which it collects through lightweight system-level instrumentation.

This repository contains the following DS2 components:
* The **Scaling policy** implements the scaling model and estimates operator parallelism using metrics collected by the reference system instrumentation.
* The **Scaling manager** periodically invokes the policy when metrics are available and sends scaling commands to the reference stream processor.
* The **Apache Flink 1.4.1 instrumentation patch** contains the necessary instrumentation for Flink to be integrated with DS2.

DS2 can be integrated with any dataflow stream processor as long as it can provide the instrumentation and metrics that its scaling policy requires. For more details on required metrics and integration, please see the [OSDI'18 paper](https://www.usenix.org/system/files/osdi18-kalavri.pdf).

## Building DS2
These instructions assume a Unix-like system.

1. DS2 is mainly developed in [Rust](https://www.rust-lang.org). You can install Rust by following [these instructions](https://www.rust-lang.org/downloads.html).

2. Compile the code (dependencies will be fetched automatically):
    ```bash
    $ cd ds2/
    $ cargo build --release --all
    ```

## Executing DS2 

There are two ways to execute DS2: _online_ and _offline_. To run DS2 online, follow the steps below:

1. Set up the DS2 configuration parameters in the [ds2.toml](https://github.com/strymon-system/ds2/blob/master/controller/config/ds2.toml) file.

2. Go to `controller/` and start the scaling manager:

```bash
$ cargo run --release --bin manager
```

Upon successful configuration, the scaling manager starts monitoring the specified metrics repository and performs the following actions:

* Updates its state every time a new rate file is created
* Invokes the scaling policy periodically
* Re-configures the streaming system automatically. To start, stop and re-configure the running system, you must write two system-specific bash scripts, such as [these](https://github.com/strymon-system/ds2/tree/master/flink-scaling-scripts) for Flink.

DS2 scaling policy can also be invoked offline on a collection of metrics generated by a dataflow execution. To do so, you need:

* A file containing the dataflow configuration, e.g. `examples/offline/flink_wordcount_topology.csv`, and
* A log file with the collected operator rates for one or more time windows, e.g. `examples/offline/flink_rates.log`

The following command evaluates the scaling policy for each time window in the rates file assuming Flink as the running system:

```bash
$ cargo run --release --bin policy -- --topo /flink_wordcount_topology.csv --rates examples/offline/flink_rates.log --system flink
```

For more information on offline execution parameters, run:

```bash
$ cargo run --release --bin policy -- --help
```

Example input files for both online and offline DS2 execution are provided [here](https://github.com/strymon-system/ds2/tree/master/controller/examples).

## Documentation

DS2 documentation can be found [here](http://strymon.systems.ethz.ch/ds2/doc/ds2/index.html).

## License

DS2 is primarily distributed under the terms of both the MIT license and the Apache License (Version 2.0).
See LICENSE-APACHE, and LICENSE-MIT for details.
